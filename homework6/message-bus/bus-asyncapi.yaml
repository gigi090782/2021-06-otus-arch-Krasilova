asyncapi: 2.0.0
info:
  title: Обработка заказов
  version: '1.0.0'
  description: |
    Пример приложения на Message Bus паттерне
defaultContentType: application/json

channels:
  billing-service/registerUser:
    publish:
      message:
        tags:
          - name: billing
        name: registerUser
        title: Регистрация пользователя
        contentType: application/json
        payload:
           type: object
           properties:
             id:
               type: integer
               format: int64
             username:
               type: string
             firstName:
               type: string
             lastName:
               type: string
             email:
               type: string
             password:
               type: string
             phone:
               type: string
             address:
               type: string
           required: 
             - username
             - password
             - email
        headers:
           type: object
           properties:
             correlationId:
               type: string
        examples:
          - payload:
              username: ivan
              firstName: Иван
              lastName: Иванов
              email: ivan@ivanov.ru
              phone: '+79161112233'
              password: 'ivan111'
              address: 'ул Ленина д 1 кв 2'
            headers:
              correlationId: 3241-1231-3123-1231

    subscribe:
      message:
        name: registerUserResponse

        headers:
           type: object
           properties:
             correlationId:
               type: string
        examples:
          - payload:
              status: OK
            headers:
              correlationId: 3241-1231-3123-1231

  billing-service/transfer:
    publish:
      message:
        tags:
          - name: billing
        name: billingTransfer
        title: Перечисление денег на аккаунт пользователя
        contentType: application/json
        payload:
          type: object
          properties:
            price:
              type: integer
              format: int64
          required:
            - price
        headers:
          type: object
          properties:
            correlationId:
              type: string
        examples:
          - payload:
              price: 567098
            headers:
              correlationId: 3241-1231-3123-1231

    subscribe:
      message:
        name: billingTransferResponse
        headers:
          type: object
          properties:
            correlationId:
              type: string
        examples:
          - payload:
              status: OK
            headers:
              correlationId: 3241-1231-3123-1231

  billing-service/withdraw:
    publish:
      message:
        tags:
          - name: billing
        name: billingWithdraw
        title: Снятие денег с аккаунта пользователя
        contentType: application/json
        payload:
          type: object
          properties:
            price:
              type: integer
              format: int64
          required:
            - price
        headers:
          type: object
          properties:
            correlationId:
              type: string
        examples:
          - payload:
              price: 567098
            headers:
              correlationId: 3241-1231-3123-1231

    subscribe:
      message:
        name: billingWithdrawResponse
        headers:
          type: object
          properties:
            correlationId:
              type: string
        examples:
          - payload:
              status: OK
            headers:
              correlationId: 3241-1231-3123-1231

  order-service/create:
    publish:
      message:
        tags:
          - name: order
        name: orderCreate
        title: Создание заказа
        contentType: application/json
        payload:
          type: object
          properties:
            price:
              type: integer
              format: int64
          required:
            - price
        headers:
          type: object
          properties:
            correlationId:
              type: string
        examples:
          - payload:
              price: 567098
            headers:
              correlationId: 3241-1231-3123-1231

    subscribe:
      message:
        name: createOrderResponse
        headers:
          type: object
          properties:
            correlationId:
              type: string
        examples:
          - payload:
              status: OK
            headers:
              correlationId: 3241-1231-3123-1231

  notification/sendEmail:
    publish:
      message:
        payload:
          type: object
          properties:
            email: 
              type: string
              format: email
        examples:
          - payload:
              email: "ivan@ivanov.com"
